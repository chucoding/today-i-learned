# Spring Cloud Config

yaml íŒŒì¼ ìš°ì„ ìˆœìœ„
```
1. bootstrap.yaml
2. application.yaml
3. application-name.yaml
4. application-name-<profile>.yaml
```
### ì„œë²„ í™˜ê²½ êµ¬ì„±
1. pom.xml
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-config-server<artifactId>
</dependency>
```

2. application.yaml
```yaml
server:
  port: 8888

spring:
  application:
    name: config-service
  cloud:
    config:
      server:
        git:
          # uri: file://C:\Users\hssuh\DISK\spring-cloud\git-local-repo
          uri: https://github.com/chucoding/spring-cloud-config.git
```
í•´ë‹¹ git íŒŒì¼ì„ ì°¸ê³ í•´ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤.

### í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ êµ¬ì„±
pom.xml
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-config</artifactId>
</dependency>

<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-bootstrap</artifactId>
</dependency>
```

bootstrap.yaml
```yaml
spring:
  cloud:
    config:
      uri: http://127.0.0.1:8888
      name: config-server
```
ğŸ’¡ ì„¤ì •ì •ë³´ë¥¼ ë¨¼ì € ê°€ì ¸ì˜¬ ìˆ˜ ìˆë„ë¡ config ì„œë²„ëŠ” bootstrap.yaml íŒŒì¼ì— ì§€ì •í•œë‹¤.
ğŸ’¡ config-serverë¡œ ì§€ì •í•´ë†“ìœ¼ë©´ ì‹¤ì œ application nameìœ¼ë¡œ ì§€ì •í•´ë†“ì€ config-serverì˜ application.yaml íŒŒì¼ì„ ì¡°íšŒí•œë‹¤

### actuator ì ìš©í•˜ê¸°
config ì»¤ë°‹ í›„ refresh APIë¡œ í´ë¼ì´ì–¸íŠ¸ì— ì¦‰ì‹œ ë°˜ì˜í•´ì£¼ëŠ” refresh API ì œê³µ

pom.xml
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

application.yaml
```yaml
management:
  endpoints:
    web:
      exposure:
        include: refresh, health, beans, httptrace
```

httptrace ì¶”ì ê´€ë¦¬ ì‚¬ìš©ë°©ë²• => Application.java
```java
@SpringBootApplication
public class ApigatewayServiceApplication {

    public static void main(String[] args) {
        SpringApplication.run(ApigatewayServiceApplication.class, args);
    }

    @Bean
    public HttpTraceRepository httpTraceRepository() {
        return new InMemoryHttpTraceRepository();
    }

}
```

### Multi-configuration êµ¬ì„±í•˜ê¸°
git
```
ecommerce.yaml
ecommerce-dev.yaml
ecommerce-prod.yaml
```

bootstrap.yaml (profiles.active ì¶”ê°€)
```yaml
spring:
  cloud:
    config:
      uri: http://127.0.0.1:8888
      name: ecommerce
  profiles:
    active: dev
```

### git ëŒ€ì‹  local íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
```yaml
spring:
  application:
    name: config-service
  profiles:
    active: native
  cloud:
    config:
      server:
        native:
          search-locations: file:///${user.home}/DISK/spring-cloud/native-file-repo
```