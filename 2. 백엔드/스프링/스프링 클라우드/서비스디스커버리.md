# DiscoveryService

### Server í™˜ê²½ êµ¬ì„±
1. í”„ë¡œì íŠ¸ ìƒì„±  
1.1. pom.xml
```xml
 <dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>
</dependency>
```

â— java ë²„ì „ì€ 8ë²„ì „ ì´ìƒ ì‚¬ìš©í•´ì•¼í•¨ => functional API (reactive rxjava - 8ë²„ì „ ì´ìƒ)

2. Eureka Server ì…‹íŒ…ë°©ë²•  
2.1. Application.java
```java
@SpringBootApplication
@EnableEurekaServer
public class Application {

	public static void main(String[] args) {
		SpringApplication.run(Application.class, args);
	}

}
```
2.2. application.yml
```yml
server:
  port: 8761

spring:
  application:
    name: discoveryservice # ê°ê°ì˜ ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ì— ë¶€ì—¬í•˜ëŠ” ê³ ìœ í•œ ì•„ì´ë””

eureka:
  client: #ìì‹ ì€ ë“±ë¡í•˜ì§€ ì•ŠìŒ(ì™¸ë¶€ì— ìˆëŠ” ë‹¤ë¥¸ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì—ì„œ ìœ ë ˆì¹´ ì„œë²„ì˜ ì •ë³´ë¥¼ ë°›ì„ í•„ìš”ê°€ ì—†ìŒ)
    register-with-eureka: false
    fetch-registry: false
```
ğŸ’¡ yml íŒŒì¼ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ?  
> ì½”ë“œ ì–‘ì„ ì¤„ì—¬ì¤Œ, ì¸í…”ë¦¬ì œì´ ìë™ì™„ì„± ì§€ì›???


### Client í™˜ê²½ êµ¬ì„±
1. í”„ë¡œì íŠ¸ ìƒì„±  
1.1. pom.xml  
devtools, eureka-client, lombok, spring web ì„¤ì¹˜
â€» lombok : setter, getter, logger, ìƒì„±ì ë“± ìë™ìœ¼ë¡œ ìƒì„±í•´ì¤˜ì„œ ì½”ë”©ì˜ ì–‘ì„ ì¤„ì—¬ì£¼ëŠ” í¸ë¦¬í•œ ì—­í• ì„ í•¨.
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
</dependency>

<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-devtools</artifactId>
    <scope>runtime</scope>
    <optional>true</optional>
</dependency>
<dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
    <optional>true</optional>
</dependency>
```

2. Eureka Client ì…‹íŒ…ë°©ë²•  
2.1. Application.java
```java
@SpringBootApplication
@EnableDiscoveryClient //@EnableEurekaClientë¥¼ ì‚¬ìš©í•´ë„ë¨(EnableDiscoveryClientì˜ êµ¬í˜„ì²´)
public class Application {

	public static void main(String[] args) {
		SpringApplication.run(Application.class, args);
	}
}
```

2.2. application.yml
```yml
server:
  port: 9001

spring:
  application:
    name: user-service

eureka:
  client:
    register-with-eureka: true
    fetch-registry: true
    service-url:
      defaultZone: http://127.0.0.1:8761/eureka #ë””ìŠ¤ì»¤ë²„ë¦¬ ì„œë²„ì— client ë“±ë¡
```

### multi client êµ¬ì„±í•˜ê¸°
í”„ë¡œì íŠ¸ë¥¼ ë³µì‚¬í•˜ì—¬ í¬íŠ¸ë²ˆí˜¸ë¥¼ ë°”ê¿”ë„ ë˜ì§€ë§Œ í¬íŠ¸ë²ˆí˜¸ë¥¼ ë°”ê¾¸ê³  ì¼ì¼ì´ ë¹Œë“œí•˜ë©´ ìƒì‚°ì„±ì´ ë–¨ì–´ì§€ë¯€ë¡œ ì¼ë°˜ì ìœ¼ë¡œëŠ” -Dserver.port=9002 ì´ìš©
#### ê³ ì • í¬íŠ¸
mavenìœ¼ë¡œ ë„ìš°ëŠ” ë°©ë²•
```cmd
mvn spring-boot:run -Dspring-boot.run.jvmArguments='-Dserver.port=9002'
```

javaë¡œ ë¹Œë“œí•œ jaríŒŒì¼ì„ ë„ìš°ëŠ” ë°©ë²•
```cmd
java -jar -Dserver.port=9003 ./target/user-service-0.0.1-SNAPSHOT.jar
```

#### ëœë¤ í¬íŠ¸
application.yml (client)
```yml
server:
  port: 0

eureka:
  instance:
    instance-id: ${spring.cloud.client.hostname}:${spring.application.instance_id:${random.value}}
```

â€» ëœë¤ í¬íŠ¸ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” -Dserver.port ì˜µì…˜ ì—†ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

ğŸ’¡ ë””ìŠ¤ì»¤ë²„ë¦¬ ì„œë²„ì—ì„œ í¬íŠ¸ë²ˆí˜¸ í™•ì¸í•˜ëŠ” ë°©ë²•
> ë””ìŠ¤ì»¤ë²„ë¦¬ ì„œë²„ì—ì„œ 0ë²ˆ í¬íŠ¸ë²ˆí˜¸ì— ë§ˆìš°ìŠ¤ ê°–ë‹¤ëŒ€ë©´ ì™¼ìª½ í•˜ë‹¨ì— í‘œì‹œë˜ëŠ” ì•Œë¦¼ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì—¬ëŸ¬ê°œë¥¼ ë„ìš¸ ê²½ìš°ì—ëŠ” application.yml íŒŒì¼ì— í‘œì‹œëœê²ƒ ì²˜ëŸ¼ instance-idë¥¼ ì´ìš©í•˜ì—¬ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤.