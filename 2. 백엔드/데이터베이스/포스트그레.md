# Postgres
대표적인 NoSQL기반 무료 데이터베이스
- 설정파일 : /etc/postgres
- 저장소 : /var/lib/postgres

# ubuntu 설치 방법
1. 설치된 패키지가 있는지 확인(이미 설치되어있는데 다시 설치하는것을 방지)
```
pg_lsclusters
```

2. 최신버전을 설치하기 위한 apt 저장소 추가
```
sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'
```

3. PostgreSQL 저장소 GPG 키 추가
```
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
```

4. 패키지 목록 재업데이트
```
sudo apt update
```

5. postgres 설치
```
sudo apt install postgresql-13
```

6. 초기화 및 클러스터 생성
```
sudo pg_createcluster 13 main --start
```

7. postgres 재시작
```
sudo service postgresql restart
```

8. postgres 접속
sudo -u postgres psql

9. 데이터베이스 생성
```
CREATE DATABASE mydb;
```

10. 비밀번호 변경
```
ALTER USER postgres WITH PASSWORD '새로운_비밀번호';
```

# centos 설치 방법

1. 설치된 패키지가 있는지 확인(이미 설치되어있는데 다시 설치하는것을 방지)
```
yum list installed | grep postgresql
```

2. 설치 가능한 postgresql 패키지 버전 확인
```shell 
yum list postgresql*
```
💡 이 때 보이는 패키지들은 아직 설치가 안된 패키지들. (TODO 디스크를 어떻게 사용하는지 공부해보자)

2.1. 만약 원하는 버전이 없다면 PostgreSQL 공식 저장소 추가
```
yum install https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm
```

3. postgresql 설치 (13버전 기준)
```
yum install postgresql13-server postgresql13-contrib
```

4. 만약 DB저장소 바꾸고 싶다면 서비스 파일 변경
```
vi /usr/lib/systemd/system/postgresql-13.service

Environment=PGDATA=/path/data #참고로 이 data 폴더는 postgres 접근권한 있어야함.
```

5. DB 초기화
```
/usr/pgsql-13/bin/postgresql-13-setup initdb
```

6. postgresql 서비스 시작 및 재부팅했을 때 PostgreSQL DB 자동 실행 활성화
```
systemctl start postgresql-13
systemctl enable postgresql-13
```

7. postgres 커널 접속
```
> psql
```

8. DB 커널 접속해서 postgres 패스워드 만들기
```
\password postgres
```

9. 다른 계정으로 접속시에는 아래와 같이 접속(.bashrc 파일에 아래 명령어 넣어놓으면 해당 계정 접속시 바로 DB로 이동되도록 사용가능)
```
psql -h localhost -U postgres -d mydatabase
```

💡 패스워드 자동화 사용시
.pgpass 파일을 만들어서 아래와 같이 입력한다. 단, .pgpass파일은 해당 계정 소유권한으로 만들어야함(root X)
```
localhost:5432:mydatabase:postgres:konan415
```

# 외부 접속 허용
1. sudo vi /etc/postgresql/12/main/postgresql.conf 수정
```
#listen_addresses = 'localhost'  => listen_addresses = '*' 
```
     
2. sudo vi /etc/postgresql/12/main/pg_hba.conf 에 아래 항목 추가
```
host    all   all  0.0.0.0/0   md5
```