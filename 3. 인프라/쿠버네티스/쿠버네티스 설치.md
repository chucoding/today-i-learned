# ì¿ ë²„ë„¤í‹°ìŠ¤ ì„¤ì¹˜í•˜ê¸°

## 1. ì„¤ì¹˜ ì—†ì´ ì¿ ë²„ë„¤í‹°ìŠ¤ ì‚¬ìš©í•˜ê¸°
- ì¹´íƒ€ì½”ë‹¤ ì¿ ë²„ë„¤í‹°ìŠ¤ í”Œë ˆì´ ê·¸ë¼ìš´ë“œ
    - https://www.katacoda.com/courses/kubernetes/playground
    - Master, node ê°ê° 1ëŒ€ì”© êµ¬ì„±ë˜ì–´ ìˆì–´ ë°”ë¡œ ì‚¬ìš©ê°€ëŠ¥
- Play with Kubernetes
    - docker ì—ì„œ ì œê³µ. docker hub ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
    - https://labs.play-with-k8s.com/
    - 4ì‹œê°„ ì‚¬ìš© ê°€ëŠ¥. Master, worker Nodeë¥¼ ì§ì ‘ êµ¬ì„±í•œ í›„ ì‚¬ìš©ê°€ëŠ¥

## 2. í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ ë„êµ¬
- êµ¬ê¸€ ì¿ ë²„ë„¤í‹°ìŠ¤ ì—”ì§„(GKE)
https://cloud.google.com/kubernetes-engine?hl=ko

- ì•„ë§ˆì¡´ ì¿ ë²„ë„¤í‹°ìŠ¤ ì¼ë˜ìŠ¤í‹± ì»¨í…Œì´ë„ˆ ì„œë¹„ìŠ¤(EKS)
https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/what-is-eks.html

- ì• ì € ì¿ ë²„ë„¤í‹°ìŠ¤ ì„œë¹„ìŠ¤(AKS)
https://docs.microsoft.com/ko-kr/azure/aks/

## 3. ê¹¡í†µ ì„œë²„(ë˜ëŠ” ë¡œì»¬)ì— ì§ì ‘ ì„¤ì¹˜í•˜ê¸°

### 3.1 í•˜ì´í¼ë°”ì´ì € ì„¤ì¹˜
1. virtualBox ì„¤ì¹˜ (https://www.virtualbox.org/)
2. virtualBox ë„¤íŠ¸ì›Œí¬ êµ¬ì„±([NAT](../ë„¤íŠ¸ì›Œí¬ê¸°ì´ˆ/README.md#ë„¤íŠ¸ì›Œí¬-ì–´ëŒ‘í„°))  
    2.1. NAT ë„¤íŠ¸ì›Œí¬ ì¶”ê°€ : ì„¤ì • - ë„¤íŠ¸ì›Œí¬  
    2.2. ë„¤íŠ¸ì›Œí¬ ì´ë¦„: k8s Network  
    2.3. ë„¤íŠ¸ì›Œí¬ CIDR: 10.100.0.0/24  
    2.4. DHCP ì§€ì›  
    2.5. í¬íŠ¸í¬ì›Œë”© ì§€ì›
    |ì´ë¦„|í”„ë¡œí† ì½œ|í˜¸ìŠ¤íŠ¸ IP|í˜¸ìŠ¤íŠ¸ í¬íŠ¸|ê²ŒìŠ¤íŠ¸ IP|ê²ŒìŠ¤íŠ¸ í¬íŠ¸|
    |---|---|---|---|---|---|
    |master|TCP|127.0.0.1|104|10.100.0.104|22|
    |node1|TCP|127.0.0.1|101|10.100.0.101|22|
    |node2|TCP|127.0.0.1|102|10.100.0.102|22|
    
    â€» í˜¸ìŠ¤íŠ¸ IPê°€ ì™¸ë¶€ë§, ê²ŒìŠ¤íŠ¸ IPê°€ ë‚´ë¶€ë§ì´ ëœë‹¤.(ssh ì ‘ì†ì‹œ í˜¸ìŠ¤íŠ¸ IPì‚¬ìš©í• ê²ƒ!)
3. VM(ê°€ìƒë¨¸ì‹ ) ë§Œë“¤ê¸°
    2core, ë™ì  í• ë‹¹, í•˜ë“œë””ìŠ¤í¬ : 20GB
4. ssh ì„œë²„, curl, vim, tree ì„¤ì¹˜
```
apt-get update
apt-get install -y openssh-server curl vim tree
```

â€» virtualBoxëŠ” ì¼ì¢…ì˜ í•˜ì´í¼ë°”ì´ì €


### 3.2 ì¿ ë²„ë„¤í‹°ìŠ¤ ì„¤ì¹˜
kubeadm, kubespray ë‘˜ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ì„œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŒ. ì•„ë˜ëŠ” kubeadmì„ ì´ìš©í•œ ì„¤ì¹˜ ë°©ë²•(ê³µì‹)

**0. node 3ê°œ ì¤€ë¹„** (ex Virtual Box)  
ìµœì†Œ ì‹œìŠ¤í…œ ì‚¬ì–‘ í™•ì¸  
https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/  

**1. ë¦¬ëˆ…ìŠ¤ í™˜ê²½ ì„¤ì •**  
1.1. swap ë©”ëª¨ë¦¬ ë„ê¸°  
```
swapoff -a && sed -i '/swap/s/^/#/' /etc/fstab
```

1.2. 6443 í¬íŠ¸ ì‚¬ìš©ê°€ëŠ¥í•œì§€ í™•ì¸  
```
nc 127.0.0.1 6443
```
ğŸ’¡ ì•„ì— ë°©í™”ë²½ ë‹¤ í—ˆìš©í•´ë„ë¨ (ë°©í™”ë²½ì€ ì£¼ë¡œ ì•ë‹¨ì—ì„œ ì²´í¬í•˜ê¸° ë•Œë¬¸)

**2. ë„ì»¤ ì„¤ì¹˜**
https://chucoding.tistory.com/99  

**3. kubeadm, kubelet, kubectl ì„¤ì¹˜**  
- kubeadm : ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ê´€ë¦¬í•˜ê³  ìš´ì˜  
- kubelet : ì¿ ë²„ë„¤í‹°ìŠ¤ ì»¨í…Œì´ë„ˆ ì¡°ì‘, ë§ˆìŠ¤í„°ì™€ í†µì‹ í•˜ëŠ” ë°ëª¬  
- kubectl : ì¿ ë²„ë„¤í‹°ìŠ¤ CLI ëª…ë ¹ì–´

ëŒ€ëµì ì¸ ì„¤ì¹˜ íë¦„ì€ ìœ„ì™€ ê°™ë‹¤. ìì„¸í•œ ì„¤ì¹˜ ëª…ë ¹ì–´ëŠ” ê³µì‹í™ˆí˜ì´ì§€ë¥¼ í†µí•´ í™•ì¸í•˜ì.  
https://kubernetes.io/ko/docs/setup/production-environment/tools/kubeadm/install-kubeadm/

â—êµ¬ê¸€ GPGí‚¤ ì˜¤ë¥˜ìˆìŒ : 
 https://dl.k8s.io/apt/doc/apt-key.gpg ì´ê±¸ë¡œ ëŒ€ì²´


### 3.3 ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° êµ¬ì„±(single node - multi master)
1. control-plane ì´ˆê¸°í™”(masterë§Œ ì‹¤í–‰)
    ```
    kubeadm init
    ```
    â—container runtime is not running :  
    1. /etc/containerd/config.toml íŒŒì¼ì—ì„œ  
    disabled_pluginì„ enabled_pluginë¡œ ë³€ê²½
    2. systemctl restart containerd

    â—couldn't get current server API group list: Get "http://localhost:8080/api?timeout=32s": dial tcp 127.0.0.1:8080:connect: connection refused  
    ```
    1 .master nodeì— ìˆëŠ” admin.conf íŒŒì¼ì„ workerì— ê°ê° ìœ„ì¹˜ì‹œí‚¤ê¸°
    2. export KUBECONFIG=/etc/kubernetes/admin.conf
    ```

    ì¶œì²˜ : https://github.com/containerd/containerd/issues/8139 


# ì°¸ê³ ìë£Œ
|title|url|
|---|---|
|ì„¤ì¹˜ ì—†ì´ ì¿ ë²„ë„¤í‹°ìŠ¤ ì‚¬ìš©í•˜ê¸°|https://www.youtube.com/watch?v=yAc6_ml4JCA&list=PLApuRlvrZKohaBHvXAOhUD-RxD0uQ3z0c&index=3|
|Virtualbox ì„¤ì¹˜|https://www.youtube.com/watch?v=PqgWp7rbqws|
|GPGí‚¤ ì˜¤ë¥˜ ë°œìƒì‹œ ëŒ€ì²˜|https://github.com/kubernetes/k8s.io/pull/4837#issuecomment-1446426585|

